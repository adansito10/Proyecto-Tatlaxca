<h2 mat-dialog-title>
  {{ 
    data.modo === 'agregar' ? 'Agregar Ingrediente' : 
    data.modo === 'editar' ? 'Editar Ingrediente' : 
    data.modo === 'eliminar' ? 'Eliminar Ingrediente' : 
    'Ver Detalles'
  }}
</h2>

<mat-dialog-content *ngIf="data.modo !== 'eliminar' && data.modo !== 'ver'">
  <mat-form-field class="w-100" appearance="fill">
    <mat-label>Nombre</mat-label>
    <input matInput [(ngModel)]="ingrediente.nombre" required>
    <mat-error *ngIf="!ingrediente.nombre">El nombre es requerido</mat-error>
  </mat-form-field>

  <mat-form-field class="w-100" appearance="fill">
    <mat-label>Unidad de Medida</mat-label>
    <mat-select [(ngModel)]="ingrediente.unidad" required>
      <mat-option value="kg">Kilogramos (kg)</mat-option>
      <mat-option value="g">Gramos (g)</mat-option>
      <mat-option value="l">Litros (l)</mat-option>
      <mat-option value="ml">Mililitros (ml)</mat-option>
      <mat-option value="unidad">Unidad</mat-option>
    </mat-select>
    <mat-error *ngIf="!ingrediente.unidad">La unidad es requerida</mat-error>
  </mat-form-field>

  <mat-form-field class="w-100" appearance="fill">
    <mat-label>Stock</mat-label>
    <input matInput type="number" [(ngModel)]="ingrediente.stock" required min="0" step="0.01">
    <mat-error *ngIf="ingrediente.stock === null || ingrediente.stock === undefined">El stock es requerido</mat-error>
  </mat-form-field>

  <div class="image-upload-section">
    <mat-label>Imagen del Ingrediente</mat-label>
    <div class="image-upload-container">
      <button mat-icon-button color="primary" (click)="triggerFileInput()" matTooltip="Subir imagen">
        <mat-icon>photo_camera</mat-icon>
      </button>
      <input id="fileInput" type="file" accept="image/*" (change)="onFileSelected($event)" style="display: none">
      
      <div class="image-preview" *ngIf="ingrediente.imagen || imagePreview">
        <img [src]="imagePreview || ingrediente.imagen" alt="Vista previa de la imagen">
        <button mat-icon-button color="warn" (click)="removeImage()" matTooltip="Eliminar imagen">
          <mat-icon>delete</mat-icon>
        </button>
      </div>
    </div>
    <mat-hint>Formatos aceptados: JPG, PNG</mat-hint>
  </div>
</mat-dialog-content>

<mat-dialog-content *ngIf="data.modo === 'ver'">
  <div class="ingrediente-details">
    <div class="ingrediente-image-container" *ngIf="ingrediente.imagen">
      <img [src]="ingrediente.imagen" alt="Imagen del ingrediente" class="ingrediente-image">
    </div>
    
    <div class="ingrediente-info">
      <p><strong>Nombre:</strong> {{ ingrediente.nombre }}</p>
      <p><strong>Unidad:</strong> {{ getUnidadTexto(ingrediente.unidad) }}</p>
      <p><strong>Stock:</strong> {{ ingrediente.stock }} {{ ingrediente.unidad }}</p>
    </div>
  </div>
</mat-dialog-content>

<mat-dialog-content *ngIf="data.modo === 'eliminar'">
  <div class="delete-confirmation">
    <p>¿Estás seguro de que deseas eliminar el siguiente ingrediente?</p>
    
    <div class="ingrediente-to-delete">
      <div class="ingrediente-image-container" *ngIf="ingrediente.imagen">
        <img [src]="ingrediente.imagen" alt="Imagen del ingrediente a eliminar" class="ingrediente-image">
      </div>
      <div class="ingrediente-info">
        <p><strong>{{ ingrediente.nombre }}</strong></p>
        <p>ID: {{ ingrediente.id }}</p>
      </div>
    </div>
  </div>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="cancelar()">Cancelar</button>
  
  <button mat-button color="warn" *ngIf="data.modo === 'eliminar'" (click)="eliminar()">
    <mat-icon>delete_forever</mat-icon> Confirmar Eliminación
  </button>
  
  <button mat-raised-button color="primary" 
          *ngIf="data.modo === 'agregar' || data.modo === 'editar'" 
          (click)="guardar()"
          [disabled]="!ingrediente.nombre || !ingrediente.unidad || ingrediente.stock === null">
    <mat-icon>save</mat-icon> Guardar
  </button>
</mat-dialog-actions>