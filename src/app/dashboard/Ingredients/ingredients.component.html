<div class="container-fluid py-4">
  <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap">
    <h2 class="fw-bold mb-2 ms-2 text-dark">Gestión de Ingredientes</h2>

    <div
      class="d-flex align-items-center mb-2 position-relative buscador-container"
    >
      <mat-icon class="icono-busqueda">search</mat-icon>
      <input
        type="text"
        class="form-control me-2 ps-5 buscador-custom"
        placeholder="Buscar Ingrediente..."
        [(ngModel)]="filtroNombre"
        style="width: 300px"
      />
    </div>

    <button class="btn custom-agregar-btn mb-2" (click)="abrirModalAgregar()">
      <mat-icon>add</mat-icon> Agregar
    </button>
  </div>

  <div class="table-responsive">
    <table
      class="table table-bordered table-hover text-center align-middle w-100"
    >
      <thead class="custom-header">
        <tr>
          <th>Nombre</th>
          <th>Unidad</th>
          <th>Stock</th>
          <th>Última actualización</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let ingrediente of ingredientesFiltrados"
          [attr.id]="ingrediente.nombre"
        >
          <td>{{ ingrediente.nombre }}</td>
          <td>{{ ingrediente.unidad }}</td>
          <td
            class="align-middle"
            [ngClass]="{
              'text-danger fw-bold': esStockBajo(ingrediente),
              'text-success fw-semibold': !esStockBajo(ingrediente)
            }"
          >
            {{ ingrediente.stock < 0 ? 0 : ingrediente.stock }}
          </td>

          <td>
            {{
              ingrediente.updated_at || ingrediente.created_at | date : "short"
            }}
          </td>
          <td>
            <span
              [ngClass]="{
                'text-success': !ingrediente.deleted_at,
                'text-danger': ingrediente.deleted_at
              }"
            >
              {{ ingrediente.deleted_at ? "Inactivo" : "Activo" }}
            </span>
          </td>
          <td>
            <div class="d-flex justify-content-center gap-2">
              <button
                class="btn btn-sm btn-success"
                (click)="abrirModalEditar(ingrediente)"
                *ngIf="!ingrediente.deleted_at"
                title="Editar"
              >
                <i class="bi bi-pencil"></i>
              </button>

              <button
                class="btn btn-sm"
                [ngClass]="
                  ingrediente.deleted_at ? 'btn-warning' : 'btn-danger'
                "
                (click)="alternarEstadoIngrediente(ingrediente)"
                [title]="ingrediente.deleted_at ? 'Activar' : 'Eliminar'"
              >
                <i
                  class="bi"
                  [ngClass]="
                    ingrediente.deleted_at ? 'bi-arrow-clockwise' : 'bi-trash'
                  "
                ></i>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
